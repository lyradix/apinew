{% extends 'base.html.twig' %}

{% block title %}Administration Concerts{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>

<div class="example-wrapper">
      <a href="{{ path('app_adminConcerts') }}" > 
        <img class="logoXtra" src="{{ asset('images/preview.png') }}" alt="logo">
     </a>
    <h1>{{ controller_name }}</h1>
    
    <a href="{{ path('app_pois') }}" > 
        <button class="box">Ajouter ou modifier un lieu</button>
    </a>
    <button class="box">Ajouter ou modifier un Partenaire Commercial</button>
    <button class="box">Ajouter ou modifier une info générale</button>
    <button class="box">Ajouter un nouvel utilisateur</button>
    <img class="profile" src="{{ asset('images/profil.png') }}" alt="profil">

    {# map through the Concerts #}
    <ul class="wrapbox">
     <li class="boxconcert">
            <div>
                <a href="{{ path('app_addConcert') }}" > 
                <img class="addbtn" src="{{ asset('images/more.png') }}" alt="add button" >
                </a>
            </div>
            </li>
        {% for concert in concerts %}
            <li class="boxconcert">
            <a href="{{ path('app_concert_show', {'id': concert.id}) }}" > 
                <div class="btnConcert">
                    <p class="text"> {{ concert.nom }} </p> 
                    <p class="text"> {{ concert.startTime|date('d/m/Y H:i') }} </p> 
                </div>
            </a>
              <button class="delBtn" data-id="{{ concert.id }}">
                <img class="delImg" src="{{ asset('images/delete.png') }}" alt="delete button">
            </button>
            </li>
          
        {% else %}
            <li>Aucun concert trouvé.</li>
        {% endfor %}

    </ul>

    <button class="box">Retour</button>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.delBtn').forEach(function(btn) {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            const concertId = this.getAttribute('data-id');
            if (window.confirm('Supprimer ce concert ?')) {
                fetch('/deleteConcert/' + concertId, {
                    method: 'DELETE',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        // Optionally remove the concert from the DOM
                        this.closest('li').remove();
                    } else {
                        alert('Erreur lors de la suppression.');
                    }
                });
            }
        });
    });
});
</script>
{% endblock %}